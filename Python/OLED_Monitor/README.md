# OnBoard OLED Monitor v1.4 - Request-Response Protocol

STM32 OnBoard LED Timer의 1.3" OLED 디스플레이를 실시간으로 모니터링하는 도구입니다.

## 🚀 새로운 기능 (v1.4)

### 요청-응답 프로토콜
- **펌웨어**: 자동 전송 없음, 명령어 요청시에만 응답
- **모니터링 도구**: 사용자 설정 주기마다 GET_SCREEN 명령 전송
- **효율성**: CPU 사용률 최적화, 데이터 충돌 방지

### 지원 명령어
- `GET_SCREEN`: 화면 데이터 요청
- `GET_STATUS`: 상태 정보 요청  
- `SET_UPDATE_MODE:REQUEST_RESPONSE,100`: 요청-응답 모드 설정
- `START_MONITOR`: 모니터링 시작 (요청-응답 방식)
- `STOP_MONITOR`: 모니터링 중지

## 🔧 설치 및 실행

### 요구사항
```bash
pip install -r requirements.txt
```

### 실행
```bash
# Windows
run_monitor.bat

# Linux/Mac
./run_monitor.sh

# 직접 실행
python oled_monitor.py
```

## 🎮 사용법

### 1. 연결 설정
1. **포트 선택**: COM3 (Windows) 또는 /dev/ttyUSB0 (Linux)
2. **보드레이트**: 921600 (권장)
3. **연결** 버튼 클릭

### 2. 갱신 주기 설정
- **50ms**: 20 FPS (부드러운 화면, 권장)
- **100ms**: 10 FPS (균형)
- **200ms**: 5 FPS (저전력)
- **500ms~2000ms**: 저속 모니터링

### 3. 자동 모니터링
1. **갱신 주기(ms)** 설정
2. **자동 화면 요청** 체크박스 활성화
3. **모니터링 시작** 버튼 클릭

### 4. 동작 흐름
```
1. 연결 → 2. 갱신 주기 설정 → 3. 자동 요청 활성화 → 4. 모니터링 시작
                ↓
펌웨어: REQUEST_RESPONSE 모드로 전환
                ↓
도구: 설정된 주기마다 GET_SCREEN 명령 전송
                ↓
펌웨어: 요청시에만 화면 데이터 응답
                ↓
도구: 화면 표시 및 성능 통계 업데이트
```

## 📊 성능 특징

### FPS 및 성공률 모니터링
- **FPS**: 실제 화면 갱신 속도
- **성공률**: 요청 대비 성공적인 응답 비율
- **실시간 통계**: 상단에 표시

### CPU 최적화
- **수동 모드**: CPU 사용량 최소화
- **자동 모드**: 설정된 주기에 따른 효율적 요청
- **실패 감지**: 연속 실패시 자동 복구

## 🛠️ 문제 해결

### 연결 문제
1. **포트 확인**: 디바이스 관리자에서 COM 포트 확인
2. **보드레이트**: 921600으로 설정
3. **펌웨어**: v1.4 Request-Response Protocol 지원 필요

### 화면 캡처 실패
1. **갱신 주기**: 50ms 이상으로 설정
2. **자동 요청**: 체크박스 활성화 확인
3. **버퍼 클리어**: 연결 해제 후 재연결

### 성능 문제
1. **주기 조절**: 더 긴 간격으로 설정 (100ms~200ms)
2. **수동 모드**: 자동 요청 비활성화
3. **선택적 모니터링**: 필요할 때만 시작

## 📋 지원 기능

### 기본 기능
- ✅ 요청-응답 기반 화면 캡처
- ✅ 사용자 정의 갱신 주기 (50ms~2000ms)
- ✅ 실시간 성능 통계
- ✅ 화면 저장 (PNG)
- ✅ 상태 정보 모니터링

### 원격 제어
- ✅ 타이머 시작/중지
- ✅ 타이머 시간 설정
- ✅ 시스템 리셋
- ✅ 연결 테스트

### 고급 기능
- ✅ 다양한 파싱 방법 지원
- ✅ 자동 저장 기능
- ✅ 세션 기록
- ✅ 로그 시스템 (중복 방지)

## 🔄 프로토콜 상세

### 요청-응답 방식
```
모니터링 도구 → GET_SCREEN → 펌웨어
모니터링 도구 ← 화면 데이터 ← 펌웨어
```

### 데이터 형식
```
<<SCREEN_START>>
SIZE:128x64
FORMAT:PAINT_IMAGE
CHECKSUM:12345678
<<DATA_START>>
[1024 bytes of screen data]
<<DATA_END>>
<<SCREEN_END>>
```

### 안정성 기능
- ✅ 체크섬 검증
- ✅ 마커 기반 데이터 구분
- ✅ 전송 오류 감지
- ✅ 타임아웃 처리

## 📝 변경사항 (v1.4)

### 주요 개선
- 🔄 **요청-응답 프로토콜**: 펌웨어 자동 전송 제거
- ⚡ **CPU 최적화**: 효율적인 요청 스케줄링
- 📊 **성능 통계**: 실시간 FPS 및 성공률 표시
- 🛡️ **안정성 강화**: 연속 실패 감지 및 복구
- 🎛️ **사용자 제어**: 갱신 주기 실시간 조절

### 호환성
- ✅ 펌웨어 v1.4 이상 필요
- ✅ 기존 파싱 방법 모두 지원
- ✅ 이전 버전 설정 호환

---

**Author**: OnBoard LED Timer Project  
**Version**: 1.4 - Request-Response Protocol  
**Date**: 2024-01-01 